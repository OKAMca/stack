# StackUi

<a alt="Nx logo" href="https://nx.dev" target="_blank" rel="noreferrer"><img src="https://raw.githubusercontent.com/nrwl/nx/master/images/nx-logo.png" width="45"></a>

✨ **This workspace has been generated by [Nx, a Smart, fast and extensible build system.](https://nx.dev)** ✨


## Start the app

To start the development server run `nx serve demo`. Open your browser and navigate to http://localhost:4200/. Happy coding!


## Generate code

If you happen to use Nx plugins, you can leverage code generators that might come with it.

Run `nx list` to get a list of available plugins and whether they have generators. Then run `nx list <plugin-name>` to see what generators are available.

Learn more about [Nx generators on the docs](https://nx.dev/plugin-features/use-code-generators).

## Running tasks

To execute tasks with Nx use the following syntax:

```
nx <target> <project> <...options>
```

You can also run multiple targets:

```
nx run-many -t <target1> <target2>
```

..or add `-p` to filter specific projects

```
nx run-many -t <target1> <target2> -p <proj1> <proj2>
```

Targets can be defined in the `package.json` or `projects.json`. Learn more [in the docs](https://nx.dev/core-features/run-tasks).

## Want better Editor Integration?

Have a look at the [Nx Console extensions](https://nx.dev/nx-console). It provides autocomplete support, a UI for exploring and running tasks & generators, and more! Available for VSCode, IntelliJ and comes with a LSP for Vim users.


Certainly! Here's an updated section for your README that includes the requirement to start the local registry before running the `publish-local` command.

---

## Local Development Workflow

When working with the `stack` collection of packages, you may need to test changes in a dependent project before committing or publishing those changes. This is especially useful when you want to ensure that updates to a package do not introduce any issues in projects that rely on it.

### Prerequisite: Start the Local Registry

Before you can publish packages locally, ensure that your local Verdaccio instance is running. You can start it using the following command:

```bash
nx run @stack-ui/source:local-registry
```

This command sets up a local registry at `http://localhost:4873`, which is necessary for the `publish-local` process.

### Publishing Packages Locally

To publish one or more packages as a "dev" version to your local Verdaccio instance, use the following command:

```bash
npx nx run @stack-ui/source:publish-local --libraries directus-next-component
```

#### Command Breakdown

- **`npx nx run`**: This is the command used to execute Nx tasks.
- **`@stack-ui/source:publish-local`**: This specifies the target project and task to run. In this case, it is the `publish-local` task for the `@stack-ui/source` project.
- **`--libraries directus-next-component`**: This option specifies the libraries you want to update and publish. You can list multiple libraries separated by commas.

#### How It Works

1. **Versioning**: The command assigns a local version to the specified libraries. By default, it uses a version format like `0.0.0-local.<timestamp>`.
   
2. **Publishing**: The libraries are published to your local Verdaccio instance. This allows you to install and test them in other projects without affecting the main registry.

3. **Installation**: If you specify a `targetPath`, the command will automatically install the updated libraries in the target project using the appropriate package manager (npm, yarn, or pnpm). If no `targetPath` is provided, it will output the installation command for manual execution.

#### Example Usage

Suppose you are working on the `directus-next-component` library and want to test it in a project located at `/path/to/your/project`. You can run:

```bash
npx nx run @stack-ui/source:publish-local --libraries directus-next-component --targetPath /path/to/your/project
```

This will publish the `directus-next-component` as a local version and install it in the specified project, allowing you to test your changes immediately.

### Error Handling

If an error occurs during the execution, detailed error messages will be logged to help you diagnose the issue. Ensure that your local Verdaccio instance is running and accessible at `http://localhost:4873`.



## Release and publish
Before any publish, releasing is mandatory if you want it to take any effect.

1. Release

You will need to be connected to github (GITHUB_TOKEN, GH_TOKEN) or with cli login.

- Install `gh`

  Linux
  ```
  sudo apt install gh
  ```

  MacOS
  ```
  brew install gh
  ```

- Connect to  github
  ```
  gh auth login
  # GitHub.com
  # SSH
  # upload  ssh public key? skip
  # how ? login with a web browser
  # press enter, login.
  ```

Run `npm run dry-release` to see the changes that will be made are all good.
Run `npm run release` to release every project independantly at once.

If you want to release only one package specifically you can use the nx command available in each project called `project-release` and `project-dry-release`

Check that the project name is inside nx.json, release.projects array.

```
# first time
npx nx run PROJECTNAME:project-dry-release --first-release
# next time
npx nx run PROJECTNAME:project-dry-release

# when you are ready
# first time
npx nx run PROJECTNAME:project-release --first-release
npx nx run PROJECTNAME:project-release
```

2. Publish

Check that projects were released before and that the tag "publishable" is inside project.json of each project.

/some/project/project.json
```
{
   "tags": [
     "publishable"
   ],
}
```

Check that the project is public in package.json
{
  "publishConfig": {
    "access": "public"
  }
}

Run the `Publish` workflow on main with github actions.

## Adding a library to the repository
After adding a library with nx, don't forget to add the path naming in tsconfig for import.

In tsconfig.base.json, compilerOptions.path, add:
```
  "@okam/package-name": ["libs/section/library/src/index.ts"],
```

In the local source code:
```
import { something } from '@okam/package-name'
```

Restart your editor to make sure typescript is recompiled.

## Codegen (internal only)

First define NEXT_PUBLIC_GRAPHQL_URL in your .env file
```
NEXT_PUBLIC_GRAPHQL_URL=https://website.com/graphql/
```

Then run codegen
```
npm run codegen
```
