{
  "project": "@okam/react-utils extraction",
  "goal": "Extract React-dependent helpers into @okam/react-utils, keep @okam/core-lib server-safe, and provide non-breaking re-exports with deprecation.",
  "statuses": [
    "pending",
    "in_progress",
    "completed",
    "blocked"
  ],
  "config": {
    "agent": "claude",
    "context": "Nx monorepo with multiple publishable packages under libs/. Uses GitHub Actions for CI.",
    "verification": "pnpm install && pnpm nx run-many -t build lint --projects=tag:publishable"
  },
  "tasks": [
    {
      "id": "1",
      "title": "Create new @okam/react-utils library skeleton",
      "description": "Add a new publishable library under libs/stack/react-utils with Vite build, dts generation, and Nx project config.",
      "status": "completed",
      "steps": [
        "Add libs/stack/react-utils/package.json with name @okam/react-utils and React peer dependency",
        "Add libs/stack/react-utils/project.json with build target outputPath dist/libs/stack/react-utils",
        "Add libs/stack/react-utils/tsconfig.json + tsconfig.lib.json",
        "Add libs/stack/react-utils/vite.config.ts mirroring core-lib patterns (nxCopyAssetsPlugin, dts, isExternal)"
      ],
      "notes": "Created library skeleton with all configuration files. React peer dep and dequal dependency will be added in Task 2 when utilities are moved."
    },
    {
      "id": "2",
      "title": "Move React utilities into react-utils",
      "description": "Relocate createCtx/createCtxNullable and hooks into the new package and expose a clean public API.",
      "status": "completed",
      "steps": [
        "Move src/utils/createContext.tsx to libs/stack/react-utils/src/utils/createContext.tsx",
        "Move hooks: usePromise and useDeepCompareMemoize into libs/stack/react-utils/src/hooks",
        "Create libs/stack/react-utils/src/index.ts exporting createCtx, createCtxNullable, usePromise, useDeepCompareMemoize",
        "Move or update tests to live under libs/stack/react-utils/src/hooks/__tests__"
      ],
      "notes": "Copied createContext.tsx, usePromise.ts, useDeepCompareMemoize.ts and their tests to react-utils. Added dequal dependency and react peer dependency. Original files kept in core-lib for Task 3 deprecation re-exports."
    },
    {
      "id": "3",
      "title": "Keep non-breaking re-exports in @okam/core-lib",
      "description": "Re-export React utilities from @okam/core-lib with deprecation JSDoc so existing consumers keep working.",
      "status": "completed",
      "steps": [
        "Update libs/stack/core-lib/src/index.ts to re-export from @okam/react-utils",
        "Add @deprecated JSDoc on createCtx/createCtxNullable exports in core-lib",
        "Ensure server-safe exports remain in core-lib default entry"
      ],
      "notes": "Updated core-lib/src/index.ts to re-export createCtx and createCtxNullable from @okam/react-utils with @deprecated JSDoc. Removed the local createContext.tsx file from core-lib. Added @okam/react-utils as a dependency to core-lib package.json. All server-safe exports (ArrayUtils, Asserts, typeguards, etc.) remain unchanged."
    },
    {
      "id": "4",
      "title": "Adjust dependencies and exports",
      "description": "Shift React peer dependency to react-utils and keep core-lib server-safe for Node consumers.",
      "status": "completed",
      "steps": [
        "Remove react peer dependency from libs/stack/core-lib/package.json (or mark optional for transition)",
        "Add react peer dependency to libs/stack/react-utils/package.json",
        "Confirm exports field for core-lib includes react-server server-safe entry (keep existing fix)"
      ],
      "notes": "Made React peer dependency optional in core-lib via peerDependenciesMeta. Added react-server export condition and server.ts entry point for server-safe builds (excludes createCtx/createCtxNullable re-exports). Updated vite.config.ts for multiple entry points. react-utils already had correct React peer dependency."
    },
    {
      "id": "5",
      "title": "Update internal consumers to use @okam/react-utils",
      "description": "Migrate stack-ui and next-component to import React helpers from the new package.",
      "status": "completed",
      "steps": [
        "Update imports in libs/stack/stack-ui to use @okam/react-utils",
        "Update imports in libs/stack/next-component to use @okam/react-utils",
        "Run typecheck/build for affected packages"
      ],
      "notes": "Updated 7 provider files in stack-ui and 2 provider files in next-component to import createCtx/createCtxNullable from @okam/react-utils instead of @okam/core-lib. Added @okam/react-utils as dependency to both packages. Removed @okam/core-lib dependency from both packages (no longer needed). Theme provider in stack-ui keeps its local createCtxNullable implementation due to different behavior (returns null vs {} as A)."
    },
    {
      "id": "6",
      "title": "Build and release validation",
      "description": "Verify outputs, Next.js build, and document migration.",
      "status": "completed",
      "steps": [
        "Run npx nx build core-lib and npx nx build react-utils",
        "Verify @okam/core-lib server build avoids React imports",
        "Run npx nx build vanier-nextjs with workarounds removed",
        "Update README/CHANGELOG with migration note and deprecation"
      ],
      "notes": "All 13 publishable projects build and lint successfully. Verified server.mjs has no React imports while index.mjs includes React for deprecated createCtx/createCtxNullable re-exports. Added migration documentation to core-lib README.md and CHANGELOG.md. Created comprehensive README.md for react-utils with API documentation."
    }
  ]
}
